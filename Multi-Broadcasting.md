# Multi-broadcasting

by Stéphane Lepin

**Current State**: phase 1 planning

### Project description

This project for Mixxx aims to add several features potentially useful
for users willing to broadcast live with Mixxx. Two new features will be
implemented : broadcasting profiles and multiple broadcasting outputs.
These features will be implemented in two parts, matching the GSoC
phases schedule.

### Broadcasting profiles (phase 1)

Broadcasting profiles allow management of several sets of server
settings/credentials and encoder settings. These can be managed through
a dedicated dialog in Mixxx's settings or a new settings panel. Profiles
have the standard Icecast/Shoutcast and encoder settings currently
available in the Live Broadcasting panel.

[[/media/wiki/broadcasting_profiles.png|]]

#### Technical details

  - Modify the BroadcastSettings class :
  - Move most config keys to a new BroadcastProfile class. Subjected
    keys are the ones with an interest for inclusion in broadcast
    profiles.
  - Profiles are saved as XML files under a "broadcast\_profiles"
    subdirectory in the settings folder
  - The BroadcastProfile class takes care of its
    serialization/deserialization from/to XML, using Qt's built-in XML
    features
  - The XML document generated by an instance of BroadcastProfile has
    the profile name as its filename
  - Add a "CurrentProfile" config key to the BroadcastSettings class.
    The value for this key is an XML document filename under
    broadcast\_profiles/, without the .xml extension
  - BroadcastSettings: Replace individual set\* methods with a single
    setCurrentProfile().
  - BroadcastSettings: Access to the current streaming settings is made
    by getting the current profile with getCurrentProfile().
  - The Settings UI (DlgPrefBroadcast class) must be updated to add
    control over and use of broadcasting profiles
  - Add a combo list of profiles
  - Selecting a profile loads its settings in the fields of the Live
    Broadcasting panel
  - Saving settings applies the current values to the currently selected
    profile
  - Add buttons to create, delete and rename profiles
  - The current profile can't be changed or edited while streaming is
    running
  - DlgPrefBroadcast::slotApply : add code to save broadcasting profiles

### Multiple broadcasting outputs (phase 2)

The new “Live Broadcasting” settings panel will consist of a list of
broadcasting outputs. The existing GUI for Live Broadcasting settings is
to be moved to a dedicated dialog, which will be spawned when the user
clicks on “Edit” next to an item of the outputs list.

[[/media/wiki/multi-broadcasting.png|]]

#### Technical details

  - The EngineBroadcast sidechain filter must be modified to only act as
    a "broadcast manager" : receive audio samples and push them to the
    output instances
  - The current libshout logic must be separated from EngineBroadcast
    and moved to a new class ShoutOutput (with QThread inheritance)
  - Class methods:

<!-- end list -->

``` 
    * Set broadcasting profile (instance of BroadcastProfile)
    * Start output (overrides QThread::run)
    * Stop output
    * Slot: Push uncompressed audio samples to output
* Each instance should have its own thread(s)
* The settings code must be updated to handle several outputs
* A new Live Broadcasting settings UI must be implemented (see UI mockup above)
* The existing Live Broadcasting settings UI must be moved to an instanciable dialog spawned by an item's "Edit" button in the new Outputs list UI.
```

<span class="underline">Possible evolution</span>: make the broadcasting
code more generic and not specific to libshout.

### Ideas

  - Drop-down item in the menu bar to start/stop streaming of one or all
    outputs

### Weekly schedule

*Work in progress*

#### Phase 1: Broadcasting profiles

##### May 30 - June 2nd

  - Write the BroadcastProfile class and its XML load/save code
  - Adapt the BroadcastSettings class: move select attributes to
    BroadcastProfile and implement get/set profile code

##### June 5 - June 9

  - Edit the Live Broadcasting UI panel to add the profile select and
    edit widgets
  - Write the logic of the new UI elements:
  - Loading the profile list on instanciation
  - Ability to create, rename and delete profiles
  - On profile selection, fill the form fields with values from that
    profile
  - On settings apply, save the form fields into the current profile

##### June 12 - June 16

  - Testing and bug hunting

##### June 19 - June 23

  - **First milestone: have this feature mergeable**
  - Project planning for Phase 2

#### Phase 2: Multi-broadcasting

To be defined.

### Useful info about the student's schedule

  - School project from May 18th to 26th
  - Another school project from June 22th to June 30th
  - School Year end: July 12th 2017
